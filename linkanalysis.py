import sys
import linkHunter

#email = '/evildocuments/email.txt'
email = sys.argv[1]
links = linkHunter.findLinks( email )
nonchecked_links = []
abstract = ''
report = ''

def addToAbstract( str ):
	global abstract
	print(str)
	abstract += str

def addToReport( str ):
	global report
	report += str


addToAbstract('Found ' + str(len(links)) + ' link(s) in email:\n')
for link in links:
	addToAbstract(link + '\n')
	print(link)
	nonchecked_links += (linkHunter.findRedirections(link))

if len(nonchecked_links) != 0:
	addToAbstract('\nFound ' + str(len(nonchecked_links)) + ' redirection(s):\n')
	for link in nonchecked_links:
		addToAbstract(link + '\n')
		nonchecked_links.remove(link)
		#nonchecked_links += (linkHunter.findRedirections(link))
		links.append(link)

if len(links) != 0:
	addToReport('All links to be analysed:\n')
	for link in links:
		addToReport(link + '\n')
	for link in links:
		addToReport('--------------------------------------------------\nIndividual analysis of:\n')
		addToReport(link + '\n\n')
		addToReport(linkHunter.passiveAnalysis(link))
		addToReport('\n\n')
		addToReport(linkHunter.contentAnalysis(link))

	userreport = open('analyses/linkanalysis.txt', 'w')
	userreport.write(report)
	userreport.close()

usermail = open('returns/usermail.txt', 'a')
usermail.write(abstract)
usermail.close()
